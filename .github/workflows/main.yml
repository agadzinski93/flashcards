name: CI
on:
  push:
    branches: ["main"]

  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Use Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '16.x'

      - name: Install Client Dependencies
        working-directory: './client'
        run: npm ci
  test:
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Run Vitest
        working-directory: './client'
        run: npm test
  deploy:
    runs-on: ubuntu-latest
    needs: test
    steps:
      - name: Deploy to cPanel
        uses: pinkasey/cpanel-deploy-action@v1.1.2
        with:
          hostname: "https://rssd9243.webaccountserver.com"
          repository_root: "/home/ovtainxn/repositories/flashcards"
          branch: main
          cpanel_username: "${{ secrets.CPANEL_USERNAME }}"
          cpanel_token: "${{ secrets.CPANEL_TOKEN }}"